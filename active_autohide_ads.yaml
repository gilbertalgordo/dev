/**
 * Active Autohide Ads AI - Kaizen Edition
 * Focus: High-speed DOM scanning and heuristic-based ad detection.
 * Source: https://github.com/gilbertalgordo/dev
 */

class AdGuardianAI {
    constructor() {
        this.adSelectors = [
            '[id*="google_ads"]', '[class*="ad-unit"]', 
            '.trc_related_container', '.outbrain',
            '[aria-label="advertisement"]', 'ins.adsbygoogle'
        ];
        this.scanInterval = 500; // 0.5s for "Superfast" response
    }

    // Heuristic analysis: Is this element behaving like an ad?
    isAdHeuristic(element) {
        const style = window.getComputedStyle(element);
        const rect = element.getBoundingClientRect();
        
        // Typical ad behavior: Fixed dimensions, specific aspect ratios, or external sources
        const isIframe = element.tagName === 'IFRAME';
        const hasFixedSize = rect.width > 0 && rect.height > 0;
        
        // Check for common ad aspect ratios (e.g., 728x90, 300x250)
        const ratio = rect.width / rect.height;
        const commonRatios = [728/90, 300/250, 160/600];
        const looksLikeAdSize = commonRatios.some(r => Math.abs(ratio - r) < 0.1);

        return (isIframe && hasFixedSize && looksLikeAdSize);
    }

    // The "Action" phase of Kaizen: Execute removal
    purify() {
        // 1. Selector-based removal (Known patterns)
        this.adSelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(el => el.remove());
        });

        // 2. Behavioral removal (The "AI" logic)
        document.querySelectorAll('div, iframe').forEach(el => {
            if (this.isAdHeuristic(el)) {
                el.style.display = 'none';
                console.log('üõ°Ô∏è AdGuardian: Neutralized potential ad element.');
            }
        });
    }

    start() {
        console.log("üöÄ AdGuardian AI Active. Monitoring DOM...");
        setInterval(() => this.purify(), this.scanInterval);
    }
}

// Initialize the Guardian
const guardian = new AdGuardianAI();
guardian.start();



/**
 * Advanced Active Autohide AI (AA-AI)
 * Characteristics: Michael (Protection) & Raphael (Healing/Cleanliness)
 * Logic: MutationObserver + Scored Heuristics
 * Source: https://github.com/gilbertalgordo/dev
 */

const AD_GUARDIAN_CONFIG = {
    threshold: 0.75, // AI confidence score required to hide
    tagsToWatch: ['DIV', 'IFRAME', 'INS', 'ASIDE'],
    indicators: ['promo', 'sponsored', 'taboola', 'ad-container', 'banner']
};

class AdvancedAdAI {
    constructor() {
        this.neutralizedCount = 0;
        this.initObserver();
    }

    // Advanced Scientific Reasoning: Weight-based scoring
    calculateAdScore(element) {
        let score = 0;
        const attrs = JSON.stringify(element.attributes).toLowerCase();
        const style = window.getComputedStyle(element);

        // 1. Keyword density check
        AD_GUARDIAN_CONFIG.indicators.forEach(term => {
            if (attrs.includes(term)) score += 0.4;
        });

        // 2. Geometry Analysis (Scientific Ratio Check)
        const rect = element.getBoundingClientRect();
        if (rect.height > 0) {
            const ratio = rect.width / rect.height;
            // Common ad ratios: 7.28 (Leaderboard), 1.2 (Square)
            if (Math.abs(ratio - 7.28) < 0.5 || Math.abs(ratio - 1.2) < 0.2) score += 0.3;
        }

        // 3. Visibility Check (Hidden ads are often trackers)
        if (style.position === 'absolute' && style.left === '-9999px') score += 0.5;

        return score;
    }

    neutralize(element) {
        if (this.calculateAdScore(element) >= AD_GUARDIAN_CONFIG.threshold) {
            element.style.visibility = 'hidden';
            element.style.height = '0px';
            element.style.pointerEvents = 'none'; // Prevent accidental clicks
            this.neutralizedCount++;
            this.updateHUD();
        }
    }

    initObserver() {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === 1 && AD_GUARDIAN_CONFIG.tagsToWatch.includes(node.tagName)) {
                        this.neutralize(node);
                    }
                });
            });
        });

        observer.observe(document.body, { childList: true, subtree: true });
        console.log("üõ°Ô∏è Archangel AI: Surveillance Active.");
    }

    updateHUD() {
        const hud = document.getElementById('ai-hud-status');
        if (hud) hud.innerText = `Ads Neutralized: ${this.neutralizedCount}`;
    }
}

const aiGuardian = new AdvancedAdAI();



#ai-hud-status {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0, 40, 80, 0.8);
    color: #00f2ff;
    padding: 15px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    border: 1px solid #00f2ff;
    box-shadow: 0 0 15px rgba(0, 242, 255, 0.5);
    z-index: 99999;
    backdrop-filter: blur(5px);
    text-transform: uppercase;
    font-size: 12px;
}

