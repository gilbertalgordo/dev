class Achievement:
    def __init__(self, id, name, criteria_key, threshold):
        self.id = id
        self.name = name
        self.criteria_key = criteria_key  # e.g., "distance_traveled"
        self.threshold = threshold        # e.g., 100
        self.unlocked = False

    def check(self, current_value):
        if not self.unlocked and current_value >= self.threshold:
            self.unlocked = True
            return True
        return False

class AchievementManager:
    def __init__(self):
        self.stats = {}
        self.achievements = []

    def add_achievement(self, achievement):
        self.achievements.append(achievement)

    def update_stat(self, key, increment):
        self.stats[key] = self.stats.get(key, 0) + increment
        return self._evaluate(key)

    def _evaluate(self, key):
        newly_unlocked = []
        for ach in self.achievements:
            if ach.criteria_key == key:
                if ach.check(self.stats[key]):
                    newly_unlocked.append(ach)
        return newly_unlocked



import time

def render_hud_notification(achievement):
    border = "=" * 30
    print(f"\n{border}")
    print(f" [!] ACHIEVEMENT UNLOCKED [!]")
    print(f" > NAME: {achievement.name}")
    print(f" > STATUS: COMPLETED")
    print(f"{border}\n")

# --- Instance Initialization ---
manager = AchievementManager()

# Define specific achievement instances
manager.add_achievement(Achievement("001", "Marathoner", "steps", 1000))
manager.add_achievement(Achievement("002", "Deep Thinker", "ai_queries", 50))

# Simulate incoming data
print("... System Monitoring Active ...")
new_unlocks = manager.update_stat("steps", 1200)

for ach in new_unlocks:
    render_hud_notification(ach)



import sqlite3
import json
from datetime import datetime

class AchievementEngine:
    def __init__(self, db_path="system_state.db"):
        self.conn = sqlite3.connect(db_path)
        self._init_db()
        self.listeners = {}

    def _init_db(self):
        cursor = self.conn.cursor()
        # Track raw statistics
        cursor.execute('''CREATE TABLE IF NOT EXISTS user_stats 
                         (stat_key TEXT PRIMARY KEY, value REAL)''')
        # Track unlocked achievements
        cursor.execute('''CREATE TABLE IF NOT EXISTS unlocks 
                         (achievement_id TEXT PRIMARY KEY, timestamp TEXT)''')
        self.conn.commit()

    def subscribe(self, stat_key, callback):
        if stat_key not in self.listeners:
            self.listeners[stat_key] = []
        self.listeners[stat_key].append(callback)

    def push_event(self, stat_key, increment=1):
        """Update stats and notify listeners for HUD updates."""
        cursor = self.conn.cursor()
        cursor.execute('''INSERT INTO user_stats (stat_key, value) VALUES (?, ?)
                          ON CONFLICT(stat_key) DO UPDATE SET value = value + ?''', 
                       (stat_key, increment, increment))
        
        # Fetch updated value
        cursor.execute("SELECT value FROM user_stats WHERE stat_key = ?", (stat_key,))
        new_value = cursor.fetchone()[0]
        self.conn.commit()

        # Trigger scientific reasoning check
        if stat_key in self.listeners:
            for callback in self.listeners[stat_key]:
                callback(stat_key, new_value)



class HUD:
    @staticmethod
    def notify(name, desc):
        print(f"\n[ HUD SYSTEM - {datetime.now().strftime('%H:%M:%S')} ]")
        print(f"â”‚ ðŸ† UNLOCKED: {name.upper()}")
        print(f"â”‚ ðŸ“ {desc}")
        print("â””" + "â”€" * 40)

class AchievementInstance:
    def __init__(self, engine, ach_id, name, target_stat, threshold):
        self.engine = engine
        self.ach_id = ach_id
        self.name = name
        self.target_stat = target_stat
        self.threshold = threshold
        
        # Self-register to the engine
        self.engine.subscribe(target_stat, self.evaluate)

    def evaluate(self, key, current_value):
        # Scientific Check: Ensure S >= T and hasn't been rewarded yet
        cursor = self.engine.conn.cursor()
        cursor.execute("SELECT 1 FROM unlocks WHERE achievement_id = ?", (self.ach_id,))
        
        if not cursor.fetchone() and current_value >= self.threshold:
            cursor.execute("INSERT INTO unlocks (achievement_id, timestamp) VALUES (?, ?)", 
                           (self.ach_id, datetime.now().isoformat()))
            self.engine.conn.commit()
            HUD.notify(self.name, f"Reached {self.threshold} in {key}!")

# --- Simulation ---
ai_engine = AchievementEngine()

# Instances representing different milestones
AchievementInstance(ai_engine, "L01", "Data Scientist", "queries", 100)
AchievementInstance(ai_engine, "L02", "Deep Diver", "compute_time", 5000)

# Simulate activity
ai_engine.push_event("queries", 105)
