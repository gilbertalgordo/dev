import pyttsx3
import speech_recognition as sr
import json

class AnnaAssistant:
    def __init__(self):
        # Gabriel's Voice: Clear and authoritative
        self.engine = pyttsx3.init()
        self.engine.setProperty('rate', 180)
        self.voices = self.engine.getProperty('voices')
        self.engine.setProperty('voice', self.voices[1].id) # Selecting a clear female tone
        
        self.hud_data = {"status": "Active", "financial_health": "Optimal"}
        self.ledger = {"balance": 0, "expenses": []}

    def speak(self, text):
        print(f"[HUD - Anna]: {text}")
        self.engine.say(text)
        self.engine.runAndWait()

    def listen(self):
        r = sr.Recognizer()
        with sr.Microphone() as source:
            print("Listening for command...")
            audio = r.listen(source)
            try:
                return r.recognize_google(audio)
            except:
                return ""

    def negotiate_salary(self, current_offer, market_avg, value_add_pct):
        """
        Uriel's Wisdom & Raguel's Harmony: 
        Calculates a fair yet aggressive counter-offer.
        """
        # Scientific reasoning: Adjustment based on Kaizen efficiency metrics
        buffer = 1.15 # 15% negotiation margin
        target = max(market_avg, current_offer) * (1 + (value_add_pct / 100)) * buffer
        
        message = f"Based on market data and your Kaizen performance, we should aim for ${target:,.2f}."
        self.speak(message)
        return target

    def audit_finances(self, income, costs):
        """Raphael's Healing: Restoring balance to the accounts."""
        self.ledger["balance"] = income - sum(costs)
        if self.ledger["balance"] < 0:
            self.speak("Warning: Financial deficit detected. Initiating cost-cutting protocols.")
        else:
            self.speak(f"Accounts balanced. Current surplus: ${self.ledger['balance']:,.2f}.")

# Instance Initialization
anna = AnnaAssistant()
anna.speak("System online. I am Anna. How shall we optimize your empire today?")



import threading
import time
import pandas as pd
import numpy as np
from datetime import datetime
import pyttsx3
import speech_recognition as sr
from colorama import Fore, Style, init

init(autoreset=True)

class AnnaAdvanced:
    def __init__(self):
        # Gabriel: Voice Configuration
        self.engine = pyttsx3.init()
        self.engine.setProperty('rate', 175)
        self.engine.setProperty('volume', 1.0)
        
        # Zerachiel: Memory & Data Persistence
        self.ledger = pd.DataFrame(columns=['Date', 'Category', 'Amount', 'Type'])
        self.goals = {"Monthly_Savings": 0.30} # 30% Kaizen target
        self.hud_active = True

    def display_hud(self):
        """Remiel: Visual HUD Projection (HD Textual Interface)"""
        while self.hud_active:
            print(f"\n{Fore.CYAN}{'='*60}")
            print(f"{Fore.YELLOW} [ ANNA HUD v2.6 ] | {datetime.now().strftime('%H:%M:%S')}")
            print(f"{Fore.CYAN}{'='*60}")
            print(f"{Fore.GREEN} MICHAEL (Security): {Fore.WHITE}Shield Active")
            print(f"{Fore.MAGENTA} URIEL (Analytic):   {Fore.WHITE}Market Volatility: Low")
            print(f"{Fore.BLUE} RAPHAEL (Finance):  {Fore.WHITE}Balance: ${self.ledger['Amount'].sum():,.2f}")
            print(f"{Fore.CYAN}{'='*60}\n")
            time.sleep(5)

    def speak(self, text):
        print(f"{Fore.MAGENTA}[ANNA]: {text}")
        self.engine.say(text)
        self.engine.runAndWait()

    def scientific_negotiation_model(self, base_offer, years_exp, growth_potential):
        """
        Raguel: Justice & Negotiation Logic.
        Uses a weighted scientific formula to determine the 'Optimal Ask'.
        Formula: Ask = Base * (1 + (Exp/10) + (Growth/20)) * Kaizen_Multiplier
        """
        kaizen_multiplier = 1.05 # 5% continuous improvement buffer
        weighted_ask = base_offer * (1 + (years_exp / 15) + (growth_potential / 100)) * kaizen_multiplier
        
        self.speak(f"Analyzing offer against market benchmarks.")
        self.speak(f"To ensure justice in compensation, our counter-proposal is ${weighted_ask:,.2f}.")
        return weighted_ask

    def optimize_finances(self):
        """Barachiel: Blessings (Profit Optimization via Kaizen)"""
        if self.ledger.empty:
            return "No data for optimization."
            
        # Scientific reasoning: Variance analysis on expenses
        expenses = self.ledger[self.ledger['Type'] == 'Expense']
        if not expenses.empty:
            avg_expense = expenses['Amount'].mean()
            self.speak(f"Kaizen Audit: Average outflow is ${avg_expense:.2f}. Reducing by 2% next cycle.")

    def run_interface(self):
        """Start the interactive session"""
        hud_thread = threading.Thread(target=self.display_hud, daemon=True)
        hud_thread.start()
        
        self.speak("System initialized. I am Anna. My logic is your shield and your sword.")
        
        # Example interaction loop
        # Here you would integrate the 'speech_recognition' logic to trigger functions
        # For this demo, we initiate a negotiation protocol
        self.scientific_negotiation_model(120000, 8, 15)

# Initialize Instance
if __name__ == "__main__":
    anna = AnnaAdvanced()
    anna.run_interface()
