import time
import random

class EnergySentinelAI:
    """
    AI Agent for Active Utility Management.
    Inspired by Archangel protection and Kaizen efficiency.
    """
    def __init__(self):
        self.threshold_kwh = 2.5  # Max allowed consumption per hour
        self.critical_load_only = False
        self.devices = {
            "HVAC": {"priority": 1, "status": "ON", "draw": 1.5},
            "Server_Rack": {"priority": 0, "status": "ON", "draw": 0.8},
            "Ambient_Lighting": {"priority": 3, "status": "ON", "draw": 0.3},
            "Water_Heater": {"priority": 2, "status": "ON", "draw": 2.0}
        }

    def get_realtime_hud(self, current_draw):
        """Displays the Heuristic Utility Determinant."""
        print(f"\n[HUD] CURRENT LOAD: {current_draw}kW | LIMIT: {self.threshold_kwh}kW")
        print(f"[HUD] SYSTEM STATUS: {'PROTECTIVE_MODE' if self.critical_load_only else 'OPTIMAL'}")
        print("-" * 40)

    def analyze_and_intervene(self):
        """Active Kaizen: Identify waste and shed load immediately."""
        total_draw = sum(d['draw'] for d in self.devices.values() if d['status'] == "ON")
        self.get_realtime_hud(total_draw)

        if total_draw > self.threshold_kwh:
            print("(!) ALERT: High energy draw detected. Initiating shed protocol...")
            # Sort by priority (higher number = less important)
            sorted_devices = sorted(self.devices.items(), key=lambda x: x[1]['priority'], reverse=True)
            
            for name, data in sorted_devices:
                if total_draw > self.threshold_kwh and data['priority'] > 0:
                    print(f"[ACTION] Cutting power to: {name} (Priority {data['priority']})")
                    self.devices[name]['status'] = "OFF"
                    total_draw -= data['draw']
        else:
            print("[STABLE] Consumption within Archangel-class safety parameters.")

    def run_cycle(self):
        """Continuous monitoring loop."""
        try:
            while True:
                self.analyze_and_intervene()
                time.sleep(5) # Superfast monitoring interval
        except KeyboardInterrupt:
            print("\nSentinel standing down. Peace be with your grid.")

# Deployment
if __name__ == "__main__":
    sentinel = EnergySentinelAI()
    sentinel.run_cycle()



import time
import datetime

class ActiveEnergyAI:
    """
    Active Anti-Bill AI: Predictive Load Shedding & Efficiency Engine.
    Powered by Kaizen principles for superfast optimization.
    """
    def __init__(self):
        # Configuration based on typical 2026 smart-home standards
        self.kwh_threshold = 2.8  # Max power limit to stay in lower billing tier
        self.peak_rate_start = 14  # 2:00 PM
        self.peak_rate_end = 20    # 8:00 PM
        
        # Priority 0: Critical (Never turn off) | Priority 5: Luxury (First to shed)
        self.load_map = {
            "Dev_Server": {"priority": 0, "wattage": 450, "status": "ON"},
            "Refrigeration": {"priority": 1, "wattage": 200, "status": "ON"},
            "HVAC_Unit": {"priority": 2, "wattage": 1800, "status": "ON"},
            "Water_Heater": {"priority": 3, "wattage": 3000, "status": "ON"},
            "Ambient_Lighting": {"priority": 4, "wattage": 150, "status": "ON"},
            "Cryptominer_Rig": {"priority": 5, "wattage": 800, "status": "ON"}
        }

    def get_real_time_price(self):
        """Simulates fetching dynamic market pricing."""
        hour = datetime.datetime.now().hour
        return 0.28 if self.peak_rate_start <= hour <= self.peak_rate_end else 0.12

    def display_hud(self, current_usage, price):
        """HUD Overlay for real-time visibility."""
        print(f"\n--- [SENTINEL HUD - {datetime.datetime.now().strftime('%H:%M:%S')}] ---")
        print(f"GRID PRICE: ${price}/kWh | CURRENT LOAD: {current_usage/1000:.2f}kW")
        print(f"TARGET LIMIT: {self.kwh_threshold}kW | MODE: ACTIVE PROTECTION")
        print("-" * 45)

    def execute_intervention(self):
        """Active Kaizen shedding logic."""
        current_price = self.get_real_time_price()
        total_usage = sum(v["wattage"] for v in self.load_map.values() if v["status"] == "ON")
        
        self.display_hud(total_usage, current_price)

        # Trigger if usage > threshold OR if prices are in 'Peak' territory
        if (total_usage / 1000) > self.kwh_threshold or current_price > 0.20:
            # Sort devices by priority (descending) to cut luxury first
            shed_list = sorted(self.load_map.items(), key=lambda x: x[1]['priority'], reverse=True)
            
            for device, info in shed_list:
                if (total_usage / 1000) > self.kwh_threshold and info["priority"] > 0:
                    print(f"[SHEDDING] Deactivating {device} to protect bill...")
                    self.load_map[device]["status"] = "OFF"
                    total_usage -= info["wattage"]
        else:
            print("[STATUS] Efficiency optimal. No intervention required.")

    def run(self):
        try:
            while True:
                self.execute_intervention()
                time.sleep(10) # High-frequency Kaizen monitoring
        except KeyboardInterrupt:
            print("\nSentinel standing down.")

if __name__ == "__main__":
    ai_agent = ActiveEnergyAI()
    ai_agent.run()
